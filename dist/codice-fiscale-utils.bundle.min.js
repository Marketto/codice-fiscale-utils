/**
 * @marketto/codice-fiscale-utils 3.0.0
 * Copyright (c) 2019-2024, Marco Ricupero <marco.ricupero@gmail.com>
 * License: MIT
 */

var CodiceFiscaleUtils=function(t,e,i){"use strict";function r(t,e,i,r){return new(i||(i=Promise))((function(s,n){function a(t){try{c(r.next(t))}catch(t){n(t)}}function o(t){try{c(r.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}c((r=r.apply(t,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const s=15,n="[12][0-9]{3}",a="0[1-9]|1[0-2]",o="0[469]|11",c="0[13578]|1[02]",h=`(?:${a})-(?:0[1-9]|[12]\\d)|(?:${o})-30|(?:${c})-3[01]`,l="[01]\\d|2[0-3]",d="[0-5]\\d",u=d,f="\\d{3}",T=`Z|[-+](?:${l})(?::?${d})?`,$=`(?:${l})(?::${d}(?::${u}(\\.${f})?)?(?:${T})?)?`,A=`${n}-(?:${h})(?:T${$})?`,E=`${n}(?:-(?:(?:${a})|(?:${h})(?:T${$})?))?`;var _=Object.freeze({__proto__:null,DAY:"0[1-9]|[12][0-9]|3[01]",DAYS_30_MONTHS:o,DAYS_31_MONTHS:c,HOURS:l,ISO8601_DATE_TIME:E,ISO8601_SHORT_DATE:A,LEAP_MONTH:"02",MILLISECONDS:f,MINUTES:d,MONTH:a,MONTH_DAY:h,SECONDS:u,TIME:$,TIMEZONE:T,YEAR:n});class p{static parseDate(t){if(!(t instanceof Date||t instanceof e||"string"==typeof t&&new RegExp(`^(?:${E})$`).test(t)||Array.isArray(t)&&t.length&&!t.some((t=>"number"!=typeof t||isNaN(t)))))return null;try{let i;if(Array.isArray(t)){const[r,s=0,n=1]=t;if(!(s>=0&&s<=11&&n>0&&n<=31))return null;i=e(Date.UTC(r,s||0,n||1))}else i=e(t);return i.isValid()?i.toDate():null}catch(t){return null}}static ymdToDate(t,e,i){return this.parseDate([t,e,i])}}const C="B-DF-HJ-NP-TV-Z",m="AEIOU",R="\\dLMNP-V",D="1-9MNP-V",v="0L",N="A-EHLMPR-T",M="DHPS",O="ACELMRT",S="A-M",I="Z",y=`[A-Z][${m}][${m}X]|[${m}]X{2}|[${C}]{2}[A-Z]`,g=y,L=`(?:${y}){2}`,P=`[${R}]{2}`,F="[02468LNQSU][048LQU]|[13579MPRTV][26NS]",b=`[${N}]`,B="[26NS]",w="[37PT]",H=`[${v}4Q][${D}]|[1256MNRS][${R}]`,Y=`[${w}][${v}]`,V=`[${w}][${v}1M]`,G=`(?:${H}|${w}[${v}1M])`,U=`(?:[${v}][${D}]|[12MN][${R}]|[3P][${v}1M])`,j=`(?:[4Q][${D}]|[56RS][${R}]|[7T][${v}1M])`,x=`${b}(?:${H})|[${M}]${Y}|[${O}]${V}`,Z=`${P}(?:${b}(?:[${v}4Q][${D}]|[15MR][${R}]|${B}[0-8LMNP-U])|[${M}]${w}[${v}]|[${O}]${w}[${v}1M]|[${M}${O}]${B}[9V])|(?:${F})B${B}[9V]`,k=`${P}(?:${b}(?:[${v}][${D}]|[1M][${R}]|[2N][0-8LMNP-U])|[${M}][3P][${v}]|[${O}][3P][${v}1M]|[${M}${O}][2N][9V])|(?:${F})B[2N][9V]`,X=`${P}(?:${b}(?:[4Q][${D}]|[5R][${R}]|[6S][0-8LMNP-U])|[${M}][7T][${v}]|[${O}][7T][${v}1M]|[${M}${O}][6S][9V])|(?:${F})B[6S][9V]`,Q=`[${S}](?:[${D}][${R}]{2}|[${v}](?:[${D}][${R}]|[${v}][${D}]))`,J=`${I}[${D}][${R}]{2}`,z=`(?:[${S}${I}][${D}][${R}]{2})|(?:[${S}][${v}](?:[${D}][${R}]|[${v}][${D}]))`,K="[A-Z]",W=`${L}(?:${Z})(?:${z})${K}`,q=`[A-Z][${m}]?|[${C}]{1,2}`,tt=`(?:${q})|(?:(?:${y})(?:${q})?)`,et=`[${R}]`,it=`${b}[${v}12456MNQRS]?|[${M}${O}]${w}`,rt=`${et}|(?:${P}(?:${it})?)`,st=`[${S}${I}](?:[${D}][${R}]?)?|[${I}](?:[${v}][${R}]?)?`,nt=`${tt}|(?:${L}(?:(?:${rt})|(?:${Z})(?:(?:${st})|(?:${z})${K}?)?)?)?`;var at,ot=Object.freeze({__proto__:null,BELFIORE_CODE_MATCHER:z,CF_FULL_NAME_MATCHER:L,CF_NAME_MATCHER:y,CF_SURNAME_MATCHER:g,CHECK_DIGIT:K,CITY_CODE_LIST:S,CITY_CODE_MATCHER:Q,CODICE_FISCALE:W,CONSONANT_LIST:C,COUNTRY_CODE_LIST:I,COUNTRY_CODE_MATCHER:J,DAY_29_MATCHER:H,DAY_2X_MATCHER:B,DAY_30_MATCHER:Y,DAY_31_MATCHER:V,DAY_3X_MATCHER:w,DAY_MATCHER:G,FEMALE_DAY_MATCHER:j,FEMALE_FULL_DATE_MATCHER:X,FULL_DATE_MATCHER:Z,LEAP_YEAR_MATCHER:F,MALE_DAY_MATCHER:U,MALE_FULL_DATE_MATCHER:k,MONTH_30DAYS_LIST:M,MONTH_31DAYS_LIST:O,MONTH_DAY_MATCHER:x,MONTH_LIST:N,MONTH_MATCHER:b,OMOCODE_NON_ZERO_NUMBER_LIST:D,OMOCODE_NUMBER_LIST:R,OMOCODE_ZERO_LIST:v,PARTIAL_BELFIORE_CODE_MATCHER:st,PARTIAL_CF:nt,PARTIAL_CF_FULL_NAME:tt,PARTIAL_CF_NAME_MATCHER:q,PARTIAL_FULL_DATE:rt,PARTIAL_MONTH_DAY:it,PARTIAL_YEAR:et,VOWEL_LIST:m,YEAR_MATCHER:P});!function(t){t[t.B=0]="B",t[t.A=1]="A",t[t.K=2]="K",t[t.P=3]="P",t[t.L=4]="L",t[t.C=5]="C",t[t.Q=6]="Q",t[t.D=7]="D",t[t.R=8]="R",t[t.E=9]="E",t[t.V=10]="V",t[t.O=11]="O",t[t.S=12]="S",t[t.F=13]="F",t[t.T=14]="T",t[t.G=15]="G",t[t.U=16]="U",t[t.H=17]="H",t[t.M=18]="M",t[t.I=19]="I",t[t.N=20]="N",t[t.J=21]="J",t[t.W=22]="W",t[t.Z=23]="Z",t[t.Y=24]="Y",t[t.X=25]="X"}(at||(at={}));var ct,ht=at;class lt{static checkDigit(t){if("string"==typeof t&&new RegExp(nt).test(t)){const e=t.substr(0,s);let i=0;for(const t of this.evaluateChar(e))i+=t;return String.fromCharCode(i%this.CRC_MOD+this.CHAR_OFFSET)}return null}static evaluateChar(t=""){return(e=this.evaluateCharGenerator(t))[Symbol.iterator]=()=>e,e;var e}static*evaluateCharGenerator(t=""){if("string"==typeof t&&t.length)for(let e=0;e<t.length;e++){let i=t[e].toUpperCase();/^\d$/u.test(i)&&(i=String.fromCharCode(parseInt(i,10)+this.CHAR_OFFSET));!(e%2)?yield parseInt(ht[i],10):yield i.charCodeAt(0)-this.CHAR_OFFSET}return 0}}lt.CHAR_OFFSET=65,lt.CRC_MOD=26,function(t){t[t.A=0]="A",t[t.B=1]="B",t[t.C=2]="C",t[t.D=3]="D",t[t.E=4]="E",t[t.H=5]="H",t[t.L=6]="L",t[t.M=7]="M",t[t.P=8]="P",t[t.R=9]="R",t[t.S=10]="S",t[t.T=11]="T"}(ct||(ct={}));var dt,ut=ct;!function(t){t[t.M=0]="M",t[t.F=40]="F"}(dt||(dt={}));var ft,Tt=dt;!function(t){t[t.L=0]="L",t[t.M=1]="M",t[t.N=2]="N",t[t.P=3]="P",t[t.Q=4]="Q",t[t.R=5]="R",t[t.S=6]="S",t[t.T=7]="T",t[t.U=8]="U",t[t.V=9]="V"}(ft||(ft={}));var $t=ft;class At{static getDay(t){const e=t%Tt.F;return e>0&&e<=this.MAX_MONTH_DAY?e:null}static getGender(t){return this.toArray().find((e=>t>=Tt[e]&&t<=Tt[e]+this.MAX_MONTH_DAY))||null}static genderizeDay(t,e){return t+Tt[e]}static toArray(){return["M","F"]}}At.MAX_MONTH_DAY=31;const Et=new Date("1973-09-29"),_t=new i;class pt{constructor(t){this.belfioreConnector=t,this.OMOCODE_BITMAP=30400,this.JOLLY_CHAR="*"}cfDeomocode(t){if(t&&t.length<=6)return t;const e=this.partialCfDeomocode(t);if(e.length<s)return e;return e.substring(0,s)+this.appyCaseToChar(lt.checkDigit(e)||"",e.substring(s,16))}cfOmocode(t,e){if(!e)return this.cfDeomocode(t);const i=t.split("");for(let r=t.length-1,s=0;r>=0;r--)if(Math.pow(2,r)&this.OMOCODE_BITMAP){if(!!(e&Math.pow(2,s))!==isNaN(parseInt(i[r],10))){const t=i[r].toUpperCase();i[r]=$t[t]}s++}const r=i[15];if(r){const t=i.slice(0,s).join("");i[15]=this.appyCaseToChar(lt.checkDigit(t)||"",r)}return i.join("")}cfOmocodeId(t){const e=t.split("").filter(((t,e)=>Math.pow(2,e)&this.OMOCODE_BITMAP)).map((t=>/^[a-z]$/i.test(_t[t])?1:0)).join("");return parseInt(e,2)}cfToLastName(t){const e=null==t?void 0:t.substring(0,3);if("string"!=typeof t||3!==e.length||!new RegExp(`^(?:${g})`,"iu").test(e))return null;const i=t.substring(0,3),[r=""]=i.match(new RegExp(`^[${C}]{1,3}`,"ig"))||[],[s=""]=i.match(new RegExp(`[${m}]{1,3}`,"ig"))||[],n=r.length+s.length;if(n<2||n<3&&"X"!==i[2].toUpperCase())return null;switch(r.length){case 3:return(r+s).split("").join(this.JOLLY_CHAR)+this.JOLLY_CHAR;case 2:return`${r[0]}${s[0]}*${r[1]}${this.JOLLY_CHAR}`;case 1:return`${r[0]}${s}${this.JOLLY_CHAR}`;default:return`${s}${3===s.length?this.JOLLY_CHAR:""}`}}cfToFirstName(t){const e=null==t?void 0:t.substring(3,6);return"string"==typeof t&&3===(null==e?void 0:e.length)&&new RegExp(`^(${y})$`,"iu").test(e)?this.cfToLastName(e):null}cfToGender(t){if("string"!=typeof t||t.length<10)return null;const e=t.substring(9,10),i=10*parseInt(this.partialCfDeomocode(e,9),10);return At.getGender(i)}cfToBirthYear(t){if("string"!=typeof t||t.length<8)return null;const i=t.substring(6,8),r=parseInt(this.partialCfDeomocode(i,6),10);if(isNaN(r))return null;const s=parseInt(e().format("YY"),10),n=100*(r>s?1:0);return e().subtract(s-r+n,"years").year()}cfToBirthMonth(t){if("string"!=typeof t||t.length<9)return null;const e=t.substring(8,9).toUpperCase(),i=ut[e];return"number"!=typeof i||i<0||i>11?null:i}cfToBirthDay(t){if("string"!=typeof t||t.length<11)return null;const e=t.substring(9,11),i=parseInt(this.partialCfDeomocode(e,9),10);return isNaN(i)?null:At.getDay(i)}cfToBirthDate(t){const e=this.cfToBirthDay(t);if(!e)return null;const i=this.cfToBirthMonth(t);if("number"!=typeof i)return null;const r=this.cfToBirthYear(t);return p.ymdToDate(r,i,e)}cfToBirthPlace(t){return r(this,arguments,void 0,(function*(t,i=!0){if("string"!=typeof t||t.length<15)return null;const r=t.substring(11,15),s=this.partialCfDeomocode(r,11),n=yield this.belfioreConnector.findByCode(s);if(!n)return null;const{creationDate:a,expirationDate:o}=n;if((a||o)&&i){const i=this.cfToBirthDate(t),r=e(Et).add(5,"years").isBefore(i,"day");if(i&&r){if(!((!o||e(i).isBefore(o,"day"))&&(!a||e(i).isAfter(a,"day"))))return null}}return n}))}cfDecode(t){return r(this,void 0,void 0,(function*(){var e;const i=this.cfToBirthYear(t)||void 0,r=null!==(e=this.cfToBirthMonth(t))&&void 0!==e?e:void 0,s=this.cfToBirthDay(t)||void 0,n=p.ymdToDate(i,r,s)||void 0,a=yield this.cfToBirthPlace(t),o={firstName:this.cfToFirstName(t)||void 0,lastName:this.cfToLastName(t)||void 0,day:s,month:r,year:i,date:n,gender:this.cfToGender(t)||void 0,place:a||void 0,omocodeId:this.cfOmocodeId(t)};return i&&r&&s&&(o.date=new Date(Date.UTC(i,r,s))),o}))}lastNameToCf(t){if(!t||(t||"").trim().length<2)return null;if(!/^[A-Z ']{1,32}$/iu.test(_t.replace(t)))return null;const e=(this.charExtractor(t,C)+this.charExtractor(t,m)).padEnd(3,"X").substring(0,3);return e.length<3?null:e.toUpperCase()}firstNameToCf(t){if(!t||(t||"").trim().length<2)return null;const e=this.charExtractor(t,C);return e.length>=4?(e[0]+e.substring(2,4)).toUpperCase():this.lastNameToCf(t)}yearToCf(t){let e;return e="string"==typeof t?parseInt(t,10):t,"number"!=typeof e||isNaN(e)||!(e>=1900||e<100)?null:`0${e}`.substr(-2)}monthToCf(t){return t<0||t>11?null:ut[t]||null}dayGenderToCf(t,e){if(t<1||t>31)return null;const i=Tt[e];return"number"!=typeof i?null:`0${t+i}`.substr(-2)}yearMonthDayToDate(t,i=0,r=1){if(!t||t<1861||[i,r].some((t=>"number"!=typeof t)))return null;const s=e(Date.UTC(t,i||0,r||1));return s.isValid()&&s.year()===t&&s.month()===i&&s.date()===r?s.toDate():null}parsePlace(t){return r(this,void 0,void 0,(function*(){let e;return t?("object"==typeof t&&t.belfioreCode?e=yield this.belfioreConnector.findByCode(t.belfioreCode):"string"==typeof t&&(e=(yield this.belfioreConnector.findByCode(t))||(yield this.belfioreConnector.findByName(t))),e||null):null}))}dateGenderToCf(t,e){const i=p.parseDate(t);if(!i)return null;return`${this.yearToCf(i.getFullYear())}${this.monthToCf(i.getMonth())}${this.dayGenderToCf(i.getDate(),e)}`}placeToCf(t,e,i){return r(this,void 0,void 0,(function*(){const r=p.parseDate(t);let s,n;if(r||"string"!=typeof t){if(!e)return null;s=e,n=i}else s=t,n=e;let a=this.belfioreConnector;if(n&&(a=a.byProvince(n)),r&&a&&(a=a.from(r)),a){const t=yield new pt(a).parsePlace(s);if(t)return t.belfioreCode}return null}))}encodeCf(t){return r(this,arguments,void 0,(function*({lastName:t,firstName:e,year:i,month:s,day:n,date:a,gender:o,place:c,omocodeId:h=0}){const l=p.parseDate(a)||this.yearMonthDayToDate(i,s,n);if(!(l&&t&&e&&o&&c))return null;const d=[()=>r(this,void 0,void 0,(function*(){return this.lastNameToCf(t)})),()=>r(this,void 0,void 0,(function*(){return this.firstNameToCf(e)})),()=>r(this,void 0,void 0,(function*(){return this.dateGenderToCf(l,o)})),()=>r(this,void 0,void 0,(function*(){return yield this.placeToCf(l,(null==c?void 0:c.belfioreCode)||c)}))];let u="";for(const t of d){const e=yield t();if(!e)return null;u+=e}return this.cfOmocode(u,h)}))}checkBitmap(t){return!!(Math.pow(2,t)&this.OMOCODE_BITMAP)}charOmocode(t,e){return/^[A-Z]$/giu.test(t)&&this.checkBitmap(e)?$t[t.toUpperCase()]:t}charExtractor(t,e){const i=new RegExp(`[${e}]{1,24}`,"ig");return(_t.replace(t).trim().match(i)||[]).join("")}partialCfDeomocode(t,e=0){return t.replace(/[\dA-Z]/giu,((t,i)=>this.charOmocode(t,i+e)))}appyCaseToChar(t,e){if(t&&e){const i=e[0]===e[0].toUpperCase(),r=e[0]===e[0].toLowerCase();if(i&&!r)return t[0].toUpperCase();if(!i&&r)return t[0].toLowerCase()}return t[0]}}const Ct="Provided lastName is not valid, only letters, diacritics and apostrophe allowed",mt="Provided name is not valid, only letters, diacritics and apostrophe allowed",Rt="Provided day is not valid",Dt="Provided gender is not valid",vt="Provided day and/or gender are not valid",Nt="Provided year is not valid, only 2 or 4 digit numbers are allowed",Mt="Provided date is not valid";var Ot=Object.freeze({__proto__:null,INVALID_DATE:Mt,INVALID_DAY:Rt,INVALID_DAY_OR_GENDER:vt,INVALID_GENDER:Dt,INVALID_NAME:mt,INVALID_PLACE_NAME:"Proviced City/Country name is not valid",INVALID_SURNAME:Ct,INVALID_YEAR:Nt});class St extends Error{constructor(t){super((Object.entries(Ot).find((([e])=>e===t))||[])[1]||t)}}const It=new i;class yt{constructor(t){this.belfioreConnector=t,this.LETTER_SET=`[A-Z${It.matcherBy(/^[A-Z]$/iu)}]`,this.SEPARATOR_SET="(?:'?\\s{0,4})",this.parser=new pt(t)}cfLastName(t){let e=g;if(t){if(!this.lastName().test(t))throw new St(Ct);e=this.parser.lastNameToCf(t)||e}return this.isolatedInsensitiveTailor(e)}cfFirstName(t){let e=y;if(t){if(!this.lastName().test(t))throw new St(mt);e=this.parser.firstNameToCf(t)||e}return this.isolatedInsensitiveTailor(e)}cfYear(t){let e=P;if(t){const i=this.parser.yearToCf(t);if(!i)throw new St(Nt);e=this.deomocode(i)}return this.isolatedInsensitiveTailor(e)}cfMonth(t){let e=b;return t&&(e=this.parser.monthToCf(t)||e),this.isolatedInsensitiveTailor(e)}cfDay(t){let e=G;if(t){const i=this.parser.dayGenderToCf(t,"M"),r=this.parser.dayGenderToCf(t,"F");if(!i||!r)throw new St(Rt);e=`(?:${this.deomocode(i)})|(?:${this.deomocode(r)})`}return this.isolatedInsensitiveTailor(e)}cfDayGender(t,e){if(!e)return this.cfDay(t);let i;if(t){const r=this.parser.dayGenderToCf(t,e);if(!r)throw new St(vt);i=this.deomocode(r)}else switch(e){case"M":i=U;break;case"F":i=j;break;default:throw new St(Dt)}return this.isolatedInsensitiveTailor(i)}cfDateGender(t,e){if(t&&!p.parseDate(t))throw new St(Mt);if(e&&!At.toArray().includes(e))throw new St(Dt);let i=Z;if(t){const r=e&&this.parser.dateGenderToCf(t,e);if(r)i=this.deomocode(r);else{const e=e=>{const i=this.parser.dateGenderToCf(t,e);if(!i)throw new St(Mt);return i&&this.deomocode(i)};i=`(?:${At.toArray().map(e).join("|")})`}}else"M"===e?i=k:"F"===e&&(i=X);return this.isolatedInsensitiveTailor(i)}cfPlace(t,e){return r(this,void 0,void 0,(function*(){let i=z;if(t){const r=p.parseDate(t);if(r&&e){const t=e,s=yield this.parser.placeToCf(r,t);i=this.deomocode(s||"")}else if(!r&&"string"==typeof t){const e=t,r=yield this.parser.placeToCf(e);i=this.deomocode(r||"")}}return this.isolatedInsensitiveTailor(i)}))}codiceFiscale(t){return r(this,void 0,void 0,(function*(){let e=W;if(t){const i=yield this.parser.encodeCf(t);if(i)e=this.deomocode(i);else{const{lastName:i,firstName:s,year:n,month:a,day:o,date:c,gender:h,place:l}=t;if(i||s||n||a||o||c||h||l){let t=null;c?t=p.parseDate(c):n&&(t=this.parser.yearMonthDayToDate(n,a,o));const d=[()=>r(this,void 0,void 0,(function*(){return this.cfLastName(i)})),()=>r(this,void 0,void 0,(function*(){return this.cfFirstName(s)})),()=>r(this,void 0,void 0,(function*(){return this.cfDateGender(t,h)})),()=>r(this,void 0,void 0,(function*(){return yield this.cfPlace(t,(null==l?void 0:l.belfioreCode)||l)}))];e="";for(const t of d){const i=(yield t()).toString(),r=i.match(/\^(.{1,256})\$/),s=r&&r[1];if(!s)throw new Error(`Unable to handle [${i}]`);e+=`(?:${s})`}e+=K}}}return this.isolatedInsensitiveTailor(e)}))}lastName(t){let e=`${this.LETTER_SET}{1,24}`;if(t&&/^[A-Z]{1,3}/iu.test(t)){const i=t.substr(0,3),r=t=>t.split("").map((t=>`[${It.insensitiveMatcher[t]}]`)),[s,n]=[`^[${C}]{1,3}`,`[${m}]{1,3}`].map((t=>r((i.match(new RegExp(t,"ig"))||[])[0]||""))),a=`[${m+It.matcherBy(new RegExp(`^[${m}]$`,"ui"))}]`,o=`(?:${a}${this.SEPARATOR_SET}){0,24}`,c=`(?:${this.SEPARATOR_SET}${o}${a})?`;switch(s.length){case 3:{const t=o;e=t+s.join(`${this.SEPARATOR_SET}${t}`)+`(?:${this.SEPARATOR_SET}${this.LETTER_SET}{0,24}${this.LETTER_SET})?`;break}case 2:e=`(?:${[`${n[0]}${o}${this.SEPARATOR_SET}${s[0]}${o}${s[1]}`,`${s[0]}${this.SEPARATOR_SET}`+n.join(`${this.SEPARATOR_SET}`)+`${this.SEPARATOR_SET}${o}${s[1]}`,s.join(`${this.SEPARATOR_SET}`)+`${this.SEPARATOR_SET}${n[0]}`].join("|")})${c}`;break;case 1:e=`(?:${[n.slice(0,2).join(`${this.SEPARATOR_SET}`)+o+s.join(`${this.SEPARATOR_SET}`),`${n[0]}${this.SEPARATOR_SET}`+s.join(`${this.SEPARATOR_SET}`)+n[1],[s[0],...n.slice(0,2)].join(`${this.SEPARATOR_SET}`)].join("|")})${c}`;break;default:e=`${n.join(`${this.SEPARATOR_SET}`)}${c}`}if((null==n?void 0:n.length)+(null==s?void 0:s.length)<3)return this.isolatedInsensitiveTailor(`\\s{0,4}(${e})\\s{0,4}`)}return this.isolatedInsensitiveTailor(`\\s{0,4}((?:${e})(?:${this.SEPARATOR_SET}${this.LETTER_SET}{1,24}){0,24})\\s{0,4}`)}firstName(t){if(t&&new RegExp(`^[A-Z]{3}[${C}]{3}`,"iu").test(t)){const e=((t.substr(3,3).match(new RegExp(`^[${C}]{1,3}`,"ig"))||[])[0]||"").split("").map((t=>`[${It.insensitiveMatcher[t]}]`)),[i,r]=[m,C].map((t=>t+It.matcherBy(new RegExp(`^[${t}]$`,"ui")))),s=`(?:[${i}]{1,24}${this.SEPARATOR_SET}){0,24}${e[0]}${this.SEPARATOR_SET}(?:[${i}]{1,24}${this.SEPARATOR_SET}){0,24}(?:[${r}]${this.SEPARATOR_SET}(?:[${i}]{1,24}${this.SEPARATOR_SET}){0,24})?`+e.slice(1,3).join(`(?:[${i}]{1,24}${this.SEPARATOR_SET}){0,24}`)+`(?:${this.SEPARATOR_SET}${this.LETTER_SET}{1,24}){0,24}`;return this.isolatedInsensitiveTailor(s)}return this.lastName((t||"").substr(3,3))}date(t){let i=E;if(t){const r=this.parser.cfToBirthDate(t);if(r){const t=r.toJSON();if(e().diff(e(r),"y")<50){const e=parseInt(t.substr(0,2),10);i=`(?:${[e-1,e].map((t=>t.toString().padStart(2,"0"))).join("|")})`+t.substr(2,8)}else i=t.substr(0,10)}}return this.isolatedInsensitiveTailor(`${i}(?:T${$}(?:${T})?)?`)}gender(t){const e=t&&this.parser.cfToGender(t)||`[${At.toArray().join("")}]`;return this.isolatedInsensitiveTailor(e)}place(t){return r(this,void 0,void 0,(function*(){let e=".{1,32}";const i=t&&(yield this.parser.cfToBirthPlace(t));if(i){e=`(?:(?:${i.name.replace(/./gu,(t=>It[t]===t?t:`[${t}${It[t]}]`))})|${i.belfioreCode})`}return this.isolatedInsensitiveTailor(e)}))}deomocode(t){return t.replace(/\d/gu,(t=>`[${t}${$t[t]}]`))}isolatedInsensitiveTailor(t){return new RegExp(`^(?:${t})$`,"iu")}}class gt{constructor(t,e){this.codiceFiscale=e,this.pattern=new yt(t),this.parser=new pt(t)}get hasLastName(){var t;return(null===(t=this.codiceFiscale)||void 0===t?void 0:t.length)>=3}get hasFirstName(){var t;return(null===(t=this.codiceFiscale)||void 0===t?void 0:t.length)>=6}get hasBirthYear(){var t;return(null===(t=this.codiceFiscale)||void 0===t?void 0:t.length)>=8}get hasBirthDate(){var t;return(null===(t=this.codiceFiscale)||void 0===t?void 0:t.length)>=11}get hasGender(){var t;return(null===(t=this.codiceFiscale)||void 0===t?void 0:t.length)>=10}get hasBirthPlace(){var t;return(null===(t=this.codiceFiscale)||void 0===t?void 0:t.length)>=15}get hasCRC(){var t;return(null===(t=this.codiceFiscale)||void 0===t?void 0:t.length)>=16}matchPersonalInfo(t){return r(this,void 0,void 0,(function*(){return(yield this.pattern.codiceFiscale(t)).test(this.codiceFiscale)}))}mismatchPersonalInfo(t){return r(this,void 0,void 0,(function*(){return!(!(this.codiceFiscale&&t&&t.lastName&&t.firstName&&(t.date||t.day&&t.month&&t.year)&&t.gender&&t.place)||(yield this.matchPersonalInfo(t)))}))}matchLastName(t){return this.hasLastName&&this.pattern.lastName(this.codiceFiscale).test(t||"")}mismatchLastName(t){return this.hasLastName&&!!t&&!this.matchLastName(t)}matchFirstName(t){return this.hasFirstName&&this.pattern.firstName(this.codiceFiscale).test(t||"")}mismatchFirstName(t){return this.hasFirstName&&!!t&&!this.matchFirstName(t)}matchBirthDate(t){if(this.hasBirthDate){const i=this.parser.cfToBirthDate(this.codiceFiscale),r=p.parseDate(t);if(i&&r)return e(i).isSame(r,"d")}return!1}mismatchBirthDate(t){return this.hasBirthYear&&!!p.parseDate(t)&&!this.matchBirthDate(t)}matchGender(t){return this.hasGender&&this.pattern.gender(this.codiceFiscale).test(t||"")}mismatchGender(t){return this.hasGender&&!!t&&!this.matchGender(t)}matchBirthPlace(t){return r(this,void 0,void 0,(function*(){if(this.hasBirthPlace&&t){const e=yield this.pattern.place(this.codiceFiscale),i=yield this.parser.parsePlace(t);return!!i&&e.test(null==i?void 0:i.belfioreCode)}return!1}))}mismatchBirthPlace(t){return r(this,void 0,void 0,(function*(){return this.hasBirthPlace&&!!t&&!(yield this.matchBirthPlace(t))}))}get errors(){return Promise.all([this.parser.cfToBirthPlace(this.codiceFiscale,!1),this.parser.cfToBirthPlace(this.codiceFiscale,!0)]).then((([t,e])=>{var i,r;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},this.parser.cfToLastName(this.codiceFiscale)?{}:{lastName:"MISSING_OR_INVALID_LAST_NAME"}),this.parser.cfToFirstName(this.codiceFiscale)?{}:{firstName:"MISSING_OR_INVALID_FIRST_NAME"}),this.parser.cfToBirthDate(this.codiceFiscale)?{}:{date:"MISSING_OR_INVALID_DATE"}),this.parser.cfToBirthDay(this.codiceFiscale)?{}:{date:"MISSING_OR_INVALID_DAY"}),this.parser.cfToBirthMonth(this.codiceFiscale)?{}:{date:"MISSING_OR_INVALID_MONTH"}),this.parser.cfToBirthYear(this.codiceFiscale)?{}:{date:"MISSING_OR_INVALID_YEAR"}),this.parser.cfToGender(this.codiceFiscale)?{}:{gender:"MISSING_DAY"}),t?{}:{place:"MISSING_OR_INVALID_PLACE"}),e?{}:{place:"PLACE_EXPIRED_OR_NOT_YET_CREATED_ON_BIRTDATE",date:"BIRTHDATE_OUT_OF_BIRTH_PLACE_LIFE_RANGE"}),(null===(r=null===(i=this.codiceFiscale)||void 0===i?void 0:i.substring(s,16))||void 0===r?void 0:r.toUpperCase())===lt.checkDigit(this.codiceFiscale)?{}:{crc:"INVALID_CRC_CODE"}),this.hasCRC?{}:{crc:"MISSING_CRC_CODE"})})).then((t=>Object.keys(t).length?t:null))}get valid(){return Promise.all([this.pattern.codiceFiscale(),this.parser.cfToBirthPlace(this.codiceFiscale)]).then((([t,e])=>{var i,r;return!(!this.hasCRC||!t.test(this.codiceFiscale)||(null===(r=null===(i=this.codiceFiscale)||void 0===i?void 0:i.substring(s,16))||void 0===r?void 0:r.toUpperCase())!==lt.checkDigit(this.codiceFiscale)||!e)}))}get invalid(){return this.valid.then((t=>!!this.codiceFiscale&&!t))}}class Lt{constructor(t){this.belfioreConnector=t,this.parser=new pt(t),this.pattern=new yt(t)}codiceFiscale(t){return new gt(this.belfioreConnector,t)}isLastNameValid(t){return this.pattern.lastName().test(t)}isLastNameInvalid(t){return!!t&&!this.isLastNameValid(t)}isFirstNameValid(t){return this.pattern.firstName().test(t)}isFirstNameInvalid(t){return!!t&&!this.isFirstNameValid(t)}isBirthDateValid(t){return!!p.parseDate(t)}isBirthDateInvalid(t){return!!t&&!this.isBirthDateValid(t)}isGenderValid(t){return this.pattern.gender().test(t)}isGenderInvalid(t){return!!t&&!this.isGenderValid(t)}isBirthPlaceValid(t){return r(this,void 0,void 0,(function*(){const e=yield this.parser.parsePlace(t);return!!e&&!!(yield this.belfioreConnector.findByCode(e.belfioreCode))}))}isBirthPlaceInvalid(t){return r(this,void 0,void 0,(function*(){return!!t&&!(yield this.isBirthPlaceValid(t))}))}birthDatePlaceMatch(t,i){return r(this,void 0,void 0,(function*(){const r=yield this.parser.parsePlace(i);return this.isBirthDateValid(t)&&!!r&&(!!(yield this.belfioreConnector.from(t).findByCode(r.belfioreCode))||e(p.parseDate(t)).isSameOrBefore(Et,"day"))}))}birthDatePlaceMismatch(t,e){return r(this,void 0,void 0,(function*(){const i=yield this.parser.parsePlace(e);return this.isBirthDateValid(t)&&!!i&&!(yield this.birthDatePlaceMatch(t,e))}))}birthPlaceDateMatch(t,e){return r(this,void 0,void 0,(function*(){return yield this.birthDatePlaceMatch(e,t)}))}birthPlaceDateMismatch(t,e){return r(this,void 0,void 0,(function*(){return yield this.birthDatePlaceMismatch(e,t)}))}}class Pt{constructor(t){this.belfioreConnector=t,this.validator=new Lt(t),this.parser=new pt(t),this.pattern=new yt(t)}}return t.BirthMonth=ut,t.CFMismatchValidator=gt,t.CRC=ht,t.CheckDigitizer=lt,t.CodiceFiscaleUtils=Pt,t.DATE_MATCHER=_,t.DateUtils=p,t.Gender=At,t.Matcher=ot,t.Omocodes=$t,t.Parser=pt,t.Pattern=yt,t.VALIDATOR=ot,t.Validator=Lt,t.default=Pt,Object.defineProperty(t,"__esModule",{value:!0}),t}({},moment,DiacriticRemover);
//# sourceMappingURL=codice-fiscale-utils.bundle.min.js.map
